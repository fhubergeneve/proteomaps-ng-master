!function(){"use strict";angular.module("libs",[]).service("_",["$window",function(a){return a._}])}(),function(){"use strict";function a(a){a.when("/submission",{templateUrl:"views/submission.html",controller:"SubmissionCtrl",controllerAs:"vm",pageKey:"UPLOAD"}).when("/results",{templateUrl:"views/results.html",controller:"ResultsCtrl",controllerAs:"vm",pageKey:"RESULTS"}).when("/results/:result_id",{templateUrl:"views/results.html",controller:"ResultsCtrl",controllerAs:"vm",pageKey:"RESULTS"}).when("/documentation",{templateUrl:"views/documentation.html",pageKey:"DOC"}).otherwise({redirectTo:"/submission"})}function b(a){a.decorator("$exceptionHandler",c)}function c(a,b,c){return function(b,d){a(b,d);c.error(b.message)}}function d(a){a.setPrefix("vikmApp").setStorageType("sessionStorage").setNotify(!0,!0)}function e(a,b){a.setBaseUrl(b.serverURL)}function f(a){a.hashPrefix("")}function g(a){angular.extend(a,{autoDismiss:!1,allowHtml:!0,containerId:"toast-container",maxOpened:5,closeButton:!0,closeHtml:"<button>&times;</button>",newestOnTop:!0,positionClass:"toast-top-right",preventDuplicates:!1,preventOpenDuplicates:!0,target:"body"})}function h(a){a.$on("$routeChangeSuccess",function(a,b){var c=b.pageKey;$(".pagekey").toggleClass("active",!1),$(".pagekey_"+c).toggleClass("active",!0)})}function i(a,b,c,d){b.setErrorInterceptor(function(a){return 404==a.status?c.info("Resource not available..."):500==a.status?d.error(a.data):501==a.status?c.error(a.data,"ERROR"):c.warning("Response received with HTTP error code: "+a.status),!0})}angular.module("vikmApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","libs","toastr","restangular","config","LocalStorageModule","smart-table","ui.tinymce","angularFileUpload","ui.bootstrap","angular.filter","angular-clipboard","ui.select","ngFileUpload","ngFileSaver"]).constant("siteTitle",{name:"MixMHCp"}).config(a).config(b).config(e).config(d).config(f).config(g).run(h).run(i),a.$inject=["$routeProvider"],b.$inject=["$provide"],c.$inject=["$delegate","$injector","$log"],d.$inject=["localStorageServiceProvider"],e.$inject=["RestangularProvider","ENV"],f.$inject=["$locationProvider"],g.$inject=["toastrConfig"],h.$inject=["$rootScope"],i.$inject=["$window","Restangular","toastr","$log"]}(),angular.module("config",[]).constant("ENV",{serverURL:"api/index.php/",imageURL:"api/image_get.php",withCredentials:!1,debugInfoEnabled:!1,CORS:!1}),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a,b){var c=a.split("\n"),d=_.filter(c,function(a){return">"!=a.charAt(0)}),e=_.filter(d,function(a){return""!=a});if(!_.some(e,function(a){return a.length==b}))return{isOK:!1,errorMessage:"<strong>PEPTIDE SEQUENCE ERROR</strong><br>Peptide sequences have to correspond to the given core length."};var f=_.map(e,function(a,b){return">"+b+"\n"+a});return{isOk:!0,fastaSeqs:f.join("\n")}}function i(a,c){var d={timeOut:5e6,closeButton:!1,iconClass:"loading-toast-icon",messageClass:"loading-toast-message",titleClass:"loading-toast-title",allowHtml:!0,preventOpenDuplicates:!0,tapToDismiss:!1};a&&!j.status.loading_data?(j.status.loading_data=!0,j.waitingToastr=b.info('<p class="text-center">Please wait, data are loading</p><p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i> <span class="sr-only">Loading...</span></p>','<p class="text-center">Loading</p>',d)):!a&&j.status.loading_data&&(j.status.loading_data=!1,b.clear(j.waitingToastr),c&&b.error("Error please reload the page"))}var j=this;j.nr_motifs=6,j.core_length=9,j.use_trash=!0,j.fasta_filename,j.siteTitle=c.name,j.status={},j.selectedFileName="No file chosen",j.downloadSampleFasta=function(){f.one("test-fasta").withHttpConfig({responseType:"blob"}).customGET().then(function(a){var b=new Blob([a],{type:"text/plain"});saveAs(b,"test.fa")})},j.insertSamplePeptides=function(){f.one("test-peptides").withHttpConfig({responseType:"blob"}).customGET().then(function(a){var b=new FileReader;b.readAsText(a),b.onloadend=function(){j.pepSeqs=b.result,g.$apply()}})},j.submitSampleFasta=function(){f.one("test-fasta").withHttpConfig({responseType:"blob"}).customGET().then(function(a){var b="test.fa",c=new File([a],b,{type:"text/plain"});j.fileData=c,j.selectedFileName=b})},j.clickBrowse=function(){$("#fastafile").click()},j.sendToBackend=function(){if(j.pepSeqs&&j.fileData)return void b.error("Please only provide a FASTA file or peptide sequences, but not both together.");var c=new FormData;if(j.pepSeqs){var d=h(j.pepSeqs,j.core_length);if(!d.isOk)return void b.error(d.errorMessage);c.append("data",d.fastaSeqs)}j.fileData&&c.append("file",j.fileData),i(!0),c.append("nr_of_motifs",j.nr_motifs),c.append("core_length",j.core_length),c.append("use_trash",j.use_trash?1:0);var e=f.all("peptides").withHttpConfig({transformRequest:angular.identity}).customPOST(c,"",void 0,{"Content-Type":void 0});e.then(function(b){i(!1),a.path("/results/"+b.result_id)},function(a){console.log("Error with status code",a.status),i(!1)})},j.uploadFile=function(a){j.selectedFileName=a.name,j.fileData=a}}angular.module("vikmApp").controller("SubmissionCtrl",a),a.$inject=["$location","toastr","siteTitle","$http","Upload","Restangular","$scope"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(a,c){var d={timeOut:5e6,closeButton:!1,iconClass:"loading-toast-icon",messageClass:"loading-toast-message",titleClass:"loading-toast-title",allowHtml:!0,preventOpenDuplicates:!0,tapToDismiss:!1};a&&!l.status.loading_data?(l.status.loading_data=!0,l.waitingToastr=b.info('<p class="text-center">Please wait, data are loading</p><p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i> <span class="sr-only">Loading...</span></p>','<p class="text-center">Loading</p>',d)):!a&&l.status.loading_data&&(l.status.loading_data=!1,b.clear(l.waitingToastr),c&&b.error("Error please reload the page"))}var l=this;l.siteTitle=c.name,l.status={};const m=4;var n=function(a){return g.mapValues(a,function(a){var b=g.map(a,function(a){var b=a;return b.imgURL=h.imageURL+"/?filename="+b.img+"&result_id="+l.resultId,b});return{motifs:g.chunk(b,m)}})};l.downloadZip=function(){f.one("results/"+l.resultId+"/zip").withHttpConfig({responseType:"blob"}).customGET().then(function(a){var b=new Blob([a],{type:"application/zip, application/octet-stream"});saveAs(b,l.resultId+".zip")})},l.selectXMer=function(a){l.selXMer=a;const b=l.xMerData[l.selXMer];l.motifData=n(b.motifs),l.showLengthDistribution=!1},l.showLengthDistributionFunc=function(){l.showLengthDistribution=!0,l.selXMer=void 0},l.sendToBackend=function(){k(!0);var a=f.one("results/"+l.resultId).get();a.then(function(a){l.xMerData=a.x_mers_data,l.lengthDistData=n(a.length_dist),l.xMers=a.x_mers,l.selXMer=a.default_x_mer;const b=l.xMerData[l.selXMer];l.motifData=n(b.motifs),l.resultId=a.result_id,l.showLengthDistribution=!1,k(!1)},function(a){console.log("Error with status code",a.status),k(!1)})},i.result_id&&(l.resultId=i.result_id,l.sendToBackend())}angular.module("vikmApp").controller("ResultsCtrl",a),a.$inject=["$location","toastr","siteTitle","$http","Upload","Restangular","_","ENV","$routeParams","FileSaver"]}(),function(){"use strict";function a(a,b,c,d){function e(a){f.projectId=a}var f=this;f.projects=[],f.setProject=e,f.siteTitle=a.name,f.currentYear=(new Date).getFullYear()}angular.module("vikmApp").controller("NavCtrl",a),a.$inject=["siteTitle","localStorageService","$scope","$filter"]}();